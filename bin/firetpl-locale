#!/usr/bin/env node
/*global XQCore:true */
var fs = require('fs'),
    path = require('path');

var program = require('commander'),
    grunt = require('grunt'),
    pkg = require('../package.json');

var FireTPL = require('../firetpl');

program.version(pkg.version)
    .description('Parse a locale dir (i18n support)')
    .usage('[options] <inputFiles>')
    .option('-o, --out <outfile>', 'Write precompiled file to <outfile>')
    .option('-v, --verbose', 'Print more infos')
    .parse(process.argv);

if (program.args.length) {
    var parser = new FireTPL.I18nParser();
    console.log('FILES:', program.args);

    program.args.forEach(function(file) {
        var filepath = path.join(process.cwd(), file);
        if (grunt.file.isFile(filepath)) {
            var langCode = file.match(/([a-zA-Z_-]+)\.json$/);
            if (Array.isArray(langCode) && langCode[1]) {
                var langConf = require(filepath);
                console.log('ADD FILE', langCode, file);
                parser.add(langCode, langConf);
            }
        }
    });
}


if (program.out) {
    var outFile = program.out;

    if (program.verbose) {
        console.log('\nWrite locales to %s', outFile);
    }

    grunt.file.write(outFile, parser.parse());
}
else {
    console.log(parser.parse());
}
